---
title: "HW4"
author: "Marco Navarro, Asha Christensen, Pranjal Maheshka"
date: "2023-04-17"
output: md_document
---

# DataMining_PS4

## Pranjal Maheshka, Asha Christensen, Marco Navarro
### 2023-04-17

## Question 2 Market segmentation

```{r setup1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ClusterR)  # for kmeans++
library(foreach)
library(mosaic)
library(cowplot)
```

In order to carry out this market segmentation exercise, we used tweets from followers of the Twitter account of the brand. Each tweet was categorized based on its content using a pre-specified scheme of 36 different categories, each representing a broad area of interest (e.g. politics, sports, family, etc.).

First of all, we eliminate some categories of the data base that do not add interesting information, such as "spam", "adult" and "chatter". Then, we calculate the ratio between the number of posts by a given user that fell into the given category and the total number annotations for each user before centering and scaling the data.

```{r , include=FALSE}
################################### Read dataset
social = read.csv("C:/Users/ACER/Desktop/Stats Learning/social_marketing.csv")

social2 = social[,-c(1,2,36,37)]

Z = social2/rowSums(social2)

#social2 = social2 %>%
#  mutate(total = rowSums(social2))

ZZ = scale(Z, center=TRUE, scale=TRUE)

```

For the market segmentation we try to divide followers (probably costumers) into different groups according to similarities in their tweets categories. Once we have identified these groups, the company will have more knowledge about their followers (costumers) and design marketing strategies accordingly.

In order to separate followers in distinct groups, we use a popular unsupervised learning method known as K-means++. As a result of this process, we divide followers in 5 different clusters and accounts whose tweets are classified to the same or similar categories end up in the same group, cluster or market segment. 

```{r , include=FALSE}
k_grid = seq(2, 30, by=1)
SSE_grid = foreach(k = k_grid, .combine='c') %do% {
cluster_k = kmeans(ZZ, k, nstart=50)
cluster_k$tot.withinss
}

plot(SSE_grid)
```

```{r , include=FALSE}
clust1 = KMeans_rcpp(ZZ, 5)
```

Once we have identified these 5 clusters, we need to associate each cluster to a category or set of categories in order to provide more useful information. To accomplish that, we perform a principal component analysis in order to know which principal component is more related to each cluster.

In the following graphs, we can visualize relationships between each cluster and the principal components. These relationships and the loadings of the principal components can be used to identify relevant categories for each cluster.

```{r , include=FALSE}
pc_Z = prcomp(ZZ, rank=10)

summary(pc_Z)

loadings = as.data.frame(pc_Z$rotation)
scores = as.data.frame(pc_Z$x)

Social3 =  cbind(ZZ,scores)
```

```{r , echo=FALSE}
## cluster  2 3 and 4 pc2
A= ggplot(Social3) + 
  geom_point(aes(PC2, PC1, color=factor(clust1$cluster)))+
  theme(legend.position = "none")

## cluster 1 and 5 pc3
B =ggplot(Social3) + 
  geom_point(aes(PC3, PC1, color=factor(clust1$cluster)))+
  theme(legend.position = "none")

## cluster 3 pc4
C =ggplot(Social3) + 
  geom_point(aes(PC3, PC4, color=factor(clust1$cluster)))+
  guides(color = guide_legend(title = "Clusters"))

library("cowplot")
ggdraw() +
  draw_plot(A, x = 0, y = .5, width = .5, height = .5) +
  draw_plot(B, x = .5, y = .5, width = .5, height = .5) +
  draw_plot(C, x = 0, y = 0, width = .6, height = 0.5)
```

The first cluster is associated with positive values of the second and third principal component (PC2 and PC3). Taking that information into account, we can see that important categories of this cluster are politics, travel, college_uni, tv_film, current_events, news, health_nutrition and personal_fitness. Consequently, this market segment includes young adults who are probably in college and are  political enthusiasts. They also have a healthy lifestyle and are also well aware of the current social and political problems.

The second cluster is associated with positive values of PC2 and negative values of PC5. In this cluster, the important categories are politics, travel, college_uni, tv_film, current_events, news,shopping, photo_sharing and eco. It is similar to the firs group (college students and interested in politics and current events), but they are probably also interested in spending their free time shopping, creating social media content instead of doing physical activities. 

The third cluster is associated with positive values of PC2 and PC5. For this cluster, important categories are politics, travel, college_uni,tv_film, current_events, news, fashion, cooking and beauty. Again, this group includes young adults in college and they care about their appearance an political events. 

The fourth Cluster is associated with negative values of PC2. The most important categories with negative loadings in this component are health_nutrition, personal_fitness, outdoors and cooking. So, we can conclude that one of the market segments is composed by people with an active and healthy lifestyle who spend a considerable part of their free time doing physical activities, and also cares about the type of food they consume.

The last cluster is associated to negative values of PC3. Categories with the lowest negative loadings in PC3 are fashion,beauty,cooking,photo_sharing,school and religion. As a result, we can conclude that one of the market segments includes adults with kids who spend a considerable amount of time sharing content on social media, In addition, they care about religion and are concerned about their own appearance.